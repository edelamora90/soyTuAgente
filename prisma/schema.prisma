// ============================================================================
// üß© SOYTUAGENTE ‚Äî Prisma Schema
// ----------------------------------------------------------------------------
// Este archivo define TODO el modelo de datos utilizado por el backend de
// SoyTuAgente (NestJS + Prisma). Est√° organizado en secciones tem√°ticas para
// facilitar la lectura, mantenimiento y escalabilidad.
//
// NOTAS DE DISE√ëO:
//   ‚Ä¢ Todos los ID son UUID/cuid para compatibilidad FE/BE.
//   ‚Ä¢ Campos DateTime se utilizan para fechas reales (ordenamiento, filtros).
//   ‚Ä¢ Strings se reservan para textos, slugs, rutas y horas tipo "HH:mm".
//   ‚Ä¢ Se evita la sobre-normalizaci√≥n: modelos planos, alta performance.
//   ‚Ä¢ Se documenta cada bloque para permitir onboarding r√°pido.
// ============================================================================



// ============================================================================
// üîß GENERATOR & DATASOURCE
// ============================================================================

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}



// ============================================================================
// üë§ ADMIN USERS ‚Äî Acceso al dashboard
// ============================================================================
model AdminUser {
  id           String    @id @default(uuid())
  email        String    @unique
  username     String?   @unique
  passwordHash String

  roles        String[]  @default(["admin"])
  isActive     Boolean   @default(true)
  tokenVersion Int       @default(0)

  lastLoginAt  DateTime?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
}



// ============================================================================
// üßë‚Äçüíº AGENTS ‚Äî Agentes aprobados
// ============================================================================
model Agent {
  id              String    @id @default(cuid())
  slug            String    @unique

  nombre          String
  cedula          String
  verificado      Boolean   @default(false)

  avatar          String?
  ubicacion       String
  whatsapp        String?

  especialidades  String[]
  experiencia     String[]
  servicios       String[]
  certificaciones String[]
  aseguradoras    String[]

  mediaThumbs     String[]
  mediaHero       String

  redes           Json?

  order           Int       @default(0)

  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
}



// ============================================================================
// üì© AGENT SUBMISSIONS ‚Äî Solicitudes de agentes
// ============================================================================
model AgentSubmission {
  id             String           @id @default(cuid())
  createdAt      DateTime         @default(now())
  updatedAt      DateTime         @updatedAt

  status         SubmissionStatus @default(PENDING)

  reviewedAt     DateTime?
  reviewedById   String?
  reviewNotes    String?

  // Datos capturados del formulario inicial
  slug           String           @unique
  nombre         String
  cedula         String?
  verificado     Boolean?         @default(false)

  foto           String?
  ubicacion      String?
  whatsapp       String?

  especialidades String[]         @default([])
  experiencia    String?
  servicios      String[]         @default([])

  aseguradoras   String?
  logroDestacado String?

  logosAseg      String[]         @default([])
  fotosMini      String[]         @default([])
  fotoHero       String?

  facebook       String?
  instagram      String?
  linkedin       String?
  tiktok         String?
}

enum SubmissionStatus {
  PENDING
  APPROVED
  REJECTED
}



// ============================================================================
// üé´ EVENTS & CAPACITACIONES ‚Äî M√≥dulo profesional de eventos
// ----------------------------------------------------------------------------
// Este modelo est√° completamente alineado con el EventEditorComponent Angular,
// con compatibilidad para:
//
//   ‚Ä¢ Creaci√≥n y edici√≥n profesional
//   ‚Ä¢ Fechas reales (DateTime) para filtros y ordenamientos
//   ‚Ä¢ Im√°genes procesadas v√≠a UploadApiService
//   ‚Ä¢ Slug SEO-friendly (opcional en esta etapa)
//   ‚Ä¢ Publicaci√≥n y programaci√≥n
//   ‚Ä¢ Destacados y portada
//
// NOTAS IMPORTANTES:
//   - startDate / endDate SON DateTime reales (ya no strings).
//   - startTime / endTime se mantienen como string "HH:mm".
//   - coverImg / speakerAvatar se guardan como rutas S3/local.
//   - isPublished controla visibilidad p√∫blica.
//   - publishedAt se puede usar m√°s adelante para programaci√≥n del evento.
// ============================================================================

model Event {
  id          String     @id @default(cuid())
  slug        String?     @unique

  // üìå Informaci√≥n principal
  title       String
  subtitle    String?
  description String

  type        EventType
  mode        EventMode

  // üóìÔ∏è Fechas principales
  startDate   DateTime             // ‚Üê Siempre DateTime real
  endDate     DateTime?            // ‚Üê Puede ser null
  startTime   String?              // HH:mm (string)
  endTime     String?              // HH:mm (string)

  // üìç Ubicaci√≥n
  address     String?              // Texto libre desde Geoapify Autocomplete

  // üñºÔ∏è Im√°genes y presentador
  coverImg      String?
  speakerName   String?
  speakerBio   String?
  speakerRole   String?
  speakerAvatar String?

  // üë• Capacidad (opcional)
  capacity     Int?
  whatsapp     String?

  // üí∞ Precio
  price        Int         @default(0)
  isFree       Boolean     @default(false)

  // üîó Enlace externo
  registrationUrl String?

  // ‚≠ê Publicaci√≥n
  isFeatured     Boolean    @default(false)
  isPublished    Boolean    @default(false)
  publishedAt    DateTime?

  createdAt      DateTime   @default(now())
  updatedAt      DateTime   @updatedAt

  //Ponente y responsable
  ponente      String?
  responsable  String?
}

enum EventType {
  EVENT
  CAPACITACION
  WEBINAR
  CURSO
}

enum EventMode {
  ONLINE
  PRESENCIAL
  HIBRIDO
}


model Post {
  id            String   @id @default(cuid())
  slug          String   @unique
  title         String
  excerpt       String?     // resumen autom√°tico
  contentHtml   String      // contenido final renderizado desde TipTap
  coverImg      String?     // portada
  readMinutes   Int?        // calculado
  isDraft       Boolean  @default(true)
  isFeatured    Boolean  @default(false)
  publishedAt   DateTime?   // si isDraft=false y hay fecha futura ‚Üí programado
  author        String       // nombre o referencia
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Opcional ‚Äî galer√≠a de im√°genes internas
  assets        PostAsset[]
}

model PostAsset {
  id        String @id @default(cuid())
  postId    String
  url       String
  createdAt DateTime @default(now())

  post      Post   @relation(fields: [postId], references: [id], onDelete: Cascade)
}



// ============================================================================
// üóÉÔ∏è Enums generales para m√≥dulos futuros (Blog, Cursos, etc.)
// ============================================================================
