<!--web/src/app/pages/admin/blog/post-editor.component.html-->
<form [formGroup]="form" (ngSubmit)="submit()" class="post-form">
  <h1>{{ postId ? 'Editar post' : 'Nuevo post' }}</h1>

  <div class="grid two">
    <label>
      <span>Título *</span>
      <input type="text" formControlName="title" placeholder="Ej. Cómo elegir tu primer seguro" />
    </label>
    <label>
      <span>Slug</span>
      <input type="text" formControlName="slug" placeholder="como-elegir-primer-seguro" />
    </label>
  </div>

  <div class="grid two">
    <label>
      <span>Tag</span>
      <input type="text" formControlName="tag" placeholder="Capacitación" />
    </label>
    <label>
      <span>Tema</span>
      <input type="text" formControlName="topic" placeholder="Guía, Estrategia…" />
    </label>
  </div>

  <div class="grid two">
    <label>
      <span>Minutos de lectura</span>
      <input type="number" min="1" formControlName="readMinutes" />
    </label>
    <label>
      <span>URL externa (opcional)</span>
      <input type="url" formControlName="externalUrl" placeholder="https://..." />
    </label>
  </div>

  <label class="block">
    <span>Contenido *</span>
    <textarea formControlName="content" rows="12" placeholder="Escribe el contenido…"></textarea>
  </label>

  <!-- ====== Portada (drag & drop) ====== -->
  <div class="form-group full">
    <span>Portada</span>

    <div
      class="dz"
      [class.dragover]="dragOverCover()"
      (dragover)="onDragOver('cover', $event)"
      (dragleave)="onDragLeave('cover')"
      (drop)="onCoverDrop($event)"
    >
      <input type="file" accept="image/*" (change)="onCoverSelect($event)" />
      <div class="placeholder" *ngIf="!coverPreview()">
        <div class="dz-title">Arrastra tu imagen aquí</div>
        <div class="dz-sub">o haz click para seleccionarla</div>
        <div class="dz-note">Será optimizada a ~300KB en el servidor</div>
      </div>
      <div class="preview" *ngIf="coverPreview()">
        <img [src]="coverPreview()!" alt="Portada" />
        <small class="hint">La imagen final se guardará como WebP optimizado.</small>
      </div>
    </div>
  </div>

  <!-- ====== Assets (drag & drop múltiple) ====== -->
  <div class="form-group full">
    <span>Galería / Assets del contenido</span>

    <div
      class="dz dz--big"
      [class.dragover]="dragOverAssets()"
      (dragover)="onDragOver('assets', $event)"
      (dragleave)="onDragLeave('assets')"
      (drop)="onAssetsDrop($event)"
    >
      <input type="file" accept="image/*" multiple (change)="onAssetsSelect($event)" />
      <div class="placeholder" *ngIf="!assetsPreview().length">
        <div class="dz-title">Arrastra imágenes aquí</div>
        <div class="dz-sub">o haz click para seleccionarlas</div>
        <div class="dz-note">Se optimizarán en el servidor (~300KB c/u)</div>
      </div>

      <div class="previews" *ngIf="assetsPreview().length">
        <div class="preview" *ngFor="let src of assetsPreview(); let i = index">
          <img [src]="src" alt="thumb" />
          <button type="button" class="remove-btn" (click)="removeAssetPreview(i)" aria-label="Quitar imagen">×</button>
        </div>
      </div>
    </div>

    <small class="hint">Estas imágenes quedarán disponibles como URLs para tu cuerpo de contenido.</small>
  </div>

  <div class="actions">
    <button type="button" class="btn ghost" (click)="cancel()">Cancelar</button>
    <button type="submit" [disabled]="saving()">{{ saving() ? 'Guardando…' : 'Guardar' }}</button>
  </div>
</form>
