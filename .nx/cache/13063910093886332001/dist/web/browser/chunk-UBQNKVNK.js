import{a as T}from"./chunk-RIVHAWGD.js";import"./chunk-RPALSS5Z.js";import{a as L,c as I}from"./chunk-UDWRQ6PZ.js";import{d as S,e as k}from"./chunk-6A4NGTZS.js";import{$a as n,Db as P,Ka as v,Oa as b,Sb as E,Tb as O,U as M,Wb as w,Z as f,Za as s,_,_a as o,ab as h,gb as A,ha as p,hb as x,jb as m,nb as C,qb as r,rb as c,vb as y,za as a}from"./chunk-A5EMK4AJ.js";var N=i=>[i,"edit"];function F(i,t){if(i&1&&(o(0,"div",13),r(1),n()),i&2){let e=m();a(),c(e.errorMsg())}}function q(i,t){i&1&&(o(0,"div",14),r(1,"Cargando..."),n())}function B(i,t){i&1&&(o(0,"span"),r(1,"Eliminar"),n())}function j(i,t){i&1&&(o(0,"span"),r(1,"Eliminando\u2026"),n())}function H(i,t){if(i&1){let e=A();o(0,"tr")(1,"td"),r(2),n(),o(3,"td")(4,"code"),r(5),n()(),o(6,"td"),r(7),n(),o(8,"td"),r(9),n(),o(10,"td"),r(11),n(),h(12,"td",17),o(13,"td",17)(14,"button",18),x("click",function(d){let g=f(e).$implicit,u=m(2),D=C(12);return u.open(g,D),_(d.stopPropagation())}),r(15,"Ver"),n(),o(16,"button",19),r(17,"Editar"),n(),o(18,"button",20),x("click",function(){let d=f(e).$implicit,g=m(2);return _(g.remove(d))}),b(19,B,2,0,"span",21)(20,j,2,0,"span",21),n()()()}if(i&2){let e=t.$implicit,l=m(2);a(2),c(e.nombre),a(3),c(e.slug),a(2),c(e.ubicacion||"\u2014"),a(2),c(e.whatsapp||"\u2014"),a(2),c((e.especialidades==null?null:e.especialidades.join(", "))||"\u2014"),a(5),s("routerLink",y(9,N,e.slug)),a(2),s("disabled",l.busySlug()===e.slug),a(),s("ngIf",l.busySlug()!==e.slug),a(),s("ngIf",l.busySlug()===e.slug)}}function $(i,t){if(i&1&&(o(0,"table",15)(1,"thead")(2,"tr")(3,"th"),r(4,"Nombre"),n(),o(5,"th"),r(6,"Slug"),n(),o(7,"th"),r(8,"Ubicaci\xF3n"),n(),o(9,"th"),r(10,"WhatsApp"),n(),o(11,"th"),r(12,"Especialidades"),n(),h(13,"th"),n()(),o(14,"tbody"),b(15,H,21,11,"tr",16),n()()),i&2){let e=m();a(15),s("ngForOf",e.filtered())("ngForTrackBy",e.trackBySlug)}}function R(i,t){i&1&&(o(0,"p",22),r(1,"No hay resultados."),n())}function z(i,t){if(i&1&&h(0,"app-agent-profile-presenter",23),i&2){let e=t.ngIf;s("agent",e)}}var V=class i{api=M(T);router=M(S);loading=p(!0);errorMsg=p(null);busySlug=p(null);rows=p([]);selected=p(null);selectedVm=p(null);q=p("");filtered=P(()=>{let t=this.q().trim().toLowerCase(),e=this.rows();return t?e.filter(l=>(l.nombre||"").toLowerCase().includes(t)||(l.slug||"").toLowerCase().includes(t)):e});ngOnInit(){this.load()}load(){this.loading.set(!0),this.errorMsg.set(null),this.api.list().subscribe({next:t=>{this.rows.set(t??[]),this.loading.set(!1)},error:t=>{this.errorMsg.set(t?.error?.message??"Error al cargar agentes."),this.loading.set(!1)}})}open(t,e){this.selected.set(t),this.selectedVm.set(I(t)),e.showModal()}close(t){t.close(),this.selected.set(null),this.selectedVm.set(null)}goEdit(t,e){e?.open&&e.close(),this.router.navigate(["/admin","dashboard","agentes",t.slug,"edit"])}remove(t,e){window.confirm(`\xBFEliminar al agente \u201C${t.nombre}\u201D? Esta acci\xF3n no se puede deshacer.`)&&(this.errorMsg.set(null),this.busySlug.set(t.slug),e?.open&&this.selected()?.slug===t.slug&&(e.close(),this.selected.set(null),this.selectedVm.set(null)),this.api.delete(t.slug).subscribe({next:()=>{this.rows.update(d=>d.filter(g=>g.slug!==t.slug))},error:d=>{this.errorMsg.set(d?.error?.message??"No se pudo eliminar el agente.")},complete:()=>{this.busySlug.set(null)}}))}trackBySlug=(t,e)=>e.slug;static \u0275fac=function(e){return new(e||i)};static \u0275cmp=v({type:i,selectors:[["app-admin-agentes-list"]],decls:20,vars:6,consts:[["qBox",""],["dlg",""],[1,"wrap"],[1,"head"],[1,"toolbar"],["type","search","placeholder","Buscar por nombre o slug...",3,"input","value"],["class","msg error",4,"ngIf"],["class","loading",4,"ngIf"],["class","table",4,"ngIf"],["class","empty",4,"ngIf"],[1,"modal-head"],[1,"close",3,"click"],[3,"agent",4,"ngIf"],[1,"msg","error"],[1,"loading"],[1,"table"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"actions"],[1,"btn","btn-ghost",3,"click"],[1,"btn","btn-primary",3,"routerLink"],["type","button",1,"btn-danger",3,"click","disabled"],[4,"ngIf"],[1,"empty"],[3,"agent"]],template:function(e,l){if(e&1){let d=A();o(0,"section",2)(1,"header",3)(2,"h1"),r(3,"Editar agentes"),n()(),o(4,"div",4)(5,"input",5,0),x("input",function(){f(d);let u=C(6);return _(l.q.set(u.value))}),n()(),b(7,F,2,1,"div",6)(8,q,2,0,"div",7)(9,$,16,2,"table",8)(10,R,2,0,"p",9),o(11,"dialog",null,1)(13,"article")(14,"header",10)(15,"h2"),r(16,"Perfil del agente"),n(),o(17,"button",11),x("click",function(){f(d);let u=C(12);return _(l.close(u))}),r(18,"\u2715"),n()(),b(19,z,1,1,"app-agent-profile-presenter",12),n()()()}e&2&&(a(5),s("value",l.q()),a(2),s("ngIf",l.errorMsg()),a(),s("ngIf",l.loading()),a(),s("ngIf",!l.loading()&&l.filtered().length),a(),s("ngIf",!l.loading()&&!l.filtered().length),a(9),s("ngIf",l.selectedVm()))},dependencies:[w,E,O,L,k],styles:[".head[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:12px}.toolbar[_ngcontent-%COMP%]{display:flex;gap:12px;margin:12px 0 16px}.toolbar[_ngcontent-%COMP%]   input[type=search][_ngcontent-%COMP%]{flex:1;border:1px solid #e5e7eb;border-radius:10px;padding:10px 12px;outline:none}.toolbar[_ngcontent-%COMP%]   input[type=search][_ngcontent-%COMP%]:focus{border-color:#4f46e5;box-shadow:0 0 0 3px #4f46e51f}.table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;font-size:.95rem}.table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{text-align:left;padding:10px 12px;background:#f9fafb;border-bottom:1px solid #eef2f7;font-weight:700}.table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:10px 12px;border-bottom:1px solid #f1f5f9;vertical-align:top}.table[_ngcontent-%COMP%]   code[_ngcontent-%COMP%]{background:#f3f4f6;padding:2px 6px;border-radius:6px}.table[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]{display:flex;gap:8px;justify-content:flex-end}.btn[_ngcontent-%COMP%]{border:0;border-radius:10px;padding:8px 12px;font-weight:600;cursor:pointer}.btn.btn-primary[_ngcontent-%COMP%]{background:#06d477;color:#fff}.btn.btn-ghost[_ngcontent-%COMP%]{background:#e3f4ed;color:#06d477}.loading[_ngcontent-%COMP%]{padding:12px;color:#6b7280}.msg.error[_ngcontent-%COMP%]{color:#ef4444;margin:8px 0}.empty[_ngcontent-%COMP%]{color:#6b7280;padding:16px 4px}dialog[_ngcontent-%COMP%]{border:0;border-radius:16px;width:min(900px,92vw);padding:0;box-shadow:0 20px 60px #00000040}dialog[_ngcontent-%COMP%]::backdrop{background:#00000059}dialog[_ngcontent-%COMP%] > article[_ngcontent-%COMP%]{padding:clamp(14px,2.6vw,22px)}.modal-head[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:8px}.modal-head[_ngcontent-%COMP%]   .close[_ngcontent-%COMP%]{border:0;background:#f3f4f6;border-radius:999px;width:34px;height:34px;cursor:pointer}.btn-danger[_ngcontent-%COMP%]{border:1px solid #ffd1d1;background:#ffecec;color:#b42318;padding:6px 10px;border-radius:10px;font-weight:800;cursor:pointer}.btn-danger[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}"]})};export{V as AdminAgentesListComponent};
